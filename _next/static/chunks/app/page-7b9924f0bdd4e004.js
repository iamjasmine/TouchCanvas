(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1063:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eK});var n=a(5155),o=a(2115),r=a(588),s=a(8301),l=a(9708),i=a(2085),c=a(9434);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=o.forwardRef((e,t)=>{let{className:a,variant:o,size:r,asChild:s=!1,...i}=e,u=s?l.DX:"button";return(0,n.jsx)(u,{className:(0,c.cn)(d({variant:o,size:r,className:a})),ref:t,...i})});u.displayName="Button";var m=a(968);let h=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),p=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(m.b,{ref:t,className:(0,c.cn)(h(),a),...o})});p.displayName=m.b.displayName;var f=a(4884);let x=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(f.bL,{className:(0,c.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...o,ref:t,children:(0,n.jsx)(f.zi,{className:(0,c.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});x.displayName=f.bL.displayName;var g=a(4073);let y=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsxs)(g.bL,{ref:t,className:(0,c.cn)("relative flex w-full touch-none select-none items-center",a),...o,children:[(0,n.jsx)(g.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,n.jsx)(g.Q6,{className:"absolute h-full bg-primary"})}),(0,n.jsx)(g.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});y.displayName=g.bL.displayName;var v=a(172),b=a(8046),N=a(7149),w=a(6378),j=a(3300),k=a(4633),A=a(9069),S=a(6804),C=a(5844),T=a(511),P=a(620);let M=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...o})});M.displayName="Card";let B=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",a),...o})});B.displayName="CardHeader";let D=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",a),...o})});D.displayName="CardTitle";let F=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,c.cn)("text-sm text-muted-foreground",a),...o})});F.displayName="CardDescription";let I=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,c.cn)("p-6 pt-0",a),...o})});I.displayName="CardContent",o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,c.cn)("flex items-center p-6 pt-0",a),...o})}).displayName="CardFooter";let R=e=>{let{isPlaying:t,isLooping:a,isActivatingAudio:o,outputMode:r,masterVolume:s,onPlay:l,onStop:i,onAddBlock:c,onAddSilenceBlock:d,onAddTemperatureBlock:m,onToggleLoop:h,onToggleOutputMode:f,onMasterVolumeChange:g,onTestAudio:B,canPlay:D,disableAddAudioBlock:F,disableAddTemperatureBlock:I}=e,R=F?"Select an audio channel first":o?"Initializing audio...":"Add Audio Block",E=F?"Select an audio channel first":o?"Initializing audio...":"Add Silence Block";return(0,n.jsx)(M,{className:"p-4 bg-muted/80 rounded-lg shadow",children:(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-3",children:[(0,n.jsxs)(u,{onClick:c,variant:"outline",className:"transition-transform hover:scale-105",disabled:F||o,title:R,children:[o&&!F?(0,n.jsx)(v.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,n.jsx)(b.A,{className:"mr-2 h-5 w-5"}),"Add Audio"]}),(0,n.jsxs)(u,{onClick:d,variant:"outline",className:"transition-transform hover:scale-105",disabled:F||o,title:E,children:[o&&!F?(0,n.jsx)(v.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,n.jsx)(N.A,{className:"mr-2 h-5 w-5"}),"Add Silence"]}),(0,n.jsxs)(u,{onClick:m,variant:"outline",className:"transition-transform hover:scale-105",disabled:I||o,title:I?"Select a thermal channel first":"Add Temperature Block",children:[(0,n.jsx)(w.A,{className:"mr-2 h-5 w-5"}),"Add Temp"]}),(0,n.jsxs)(u,{onClick:l,disabled:t||!D||o,variant:"default",className:"bg-gradient-to-r from-primary to-accent text-primary-foreground hover:opacity-90 transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50","aria-label":"Play audio sequence",title:o?"Initializing audio...":t?"Playback in progress":D?"Play":"No valid audio blocks to play or channel muted",children:[o&&D&&!t?(0,n.jsx)(v.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,n.jsx)(j.A,{className:"mr-2 h-5 w-5"}),"Play"]}),(0,n.jsxs)(u,{onClick:i,disabled:!t||o,variant:"destructive",className:"transition-transform hover:scale-105 disabled:opacity-50","aria-label":"Stop audio playback",title:o?"Audio system busy":t?"Stop":"Not playing",children:[(0,n.jsx)(k.A,{className:"mr-2 h-5 w-5"}),"Stop"]}),(0,n.jsxs)(u,{onClick:h,variant:a?"default":"outline",className:"transition-transform hover:scale-105","aria-pressed":a,"aria-label":a?"Disable Loop":"Enable Loop",title:a?"Disable Loop":"Enable Loop",disabled:o,children:[(0,n.jsx)(A.A,{className:"mr-2 h-5 w-5"}),a?"Looping":"Loop"]}),(0,n.jsxs)(u,{onClick:B,variant:"outline",className:"transition-transform hover:scale-105",title:"Test Basic Audio Output",disabled:o,children:[o?(0,n.jsx)(v.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,n.jsx)(S.A,{className:"mr-2 h-5 w-5"}),"Test Audio"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded-md border border-input bg-background transition-transform hover:scale-105",children:["mixed"===r?(0,n.jsx)(C.A,{className:"h-5 w-5 text-primary"}):(0,n.jsx)(T.A,{className:"h-5 w-5 text-accent"}),(0,n.jsx)(p,{htmlFor:"output-mode-switch",className:"cursor-pointer text-sm font-medium pr-1",children:"mixed"===r?"Mixed":"Independent"}),(0,n.jsx)(x,{id:"output-mode-switch",checked:"independent"===r,onCheckedChange:f,"aria-label":"Current mode: ".concat("mixed"===r?"Mixed":"Independent"," Output. Switch to ").concat("mixed"===r?"Independent":"Mixed"," Output."),title:"Toggle Output Mode",disabled:o})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded-md border border-input bg-background min-w-[200px] transition-transform hover:scale-105",children:[(0,n.jsx)(P.A,{className:"h-5 w-5 text-primary"}),(0,n.jsxs)(p,{htmlFor:"master-volume",className:"text-sm font-medium pr-1 whitespace-nowrap",children:["Master Vol: ",Math.round(100*s),"%"]}),(0,n.jsx)(y,{id:"master-volume",min:0,max:1,step:.01,value:[s],onValueChange:e=>g(e[0]),className:"flex-grow","aria-label":"Master volume control",title:"Adjust Master Volume",disabled:o})]})]})})};var E=a(1992),O=a(9556),V=a(7381),L=a(518);let U=E.bL;E.YJ;let z=E.WT,_=o.forwardRef((e,t)=>{let{className:a,children:o,...r}=e;return(0,n.jsxs)(E.l9,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...r,children:[o,(0,n.jsx)(E.In,{asChild:!0,children:(0,n.jsx)(O.A,{className:"h-4 w-4 opacity-50"})})]})});_.displayName=E.l9.displayName;let q=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(E.PP,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...o,children:(0,n.jsx)(V.A,{className:"h-4 w-4"})})});q.displayName=E.PP.displayName;let W=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(E.wn,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...o,children:(0,n.jsx)(O.A,{className:"h-4 w-4"})})});W.displayName=E.wn.displayName;let H=o.forwardRef((e,t)=>{let{className:a,children:o,position:r="popper",...s}=e;return(0,n.jsx)(E.ZL,{children:(0,n.jsxs)(E.UC,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:r,...s,children:[(0,n.jsx)(q,{}),(0,n.jsx)(E.LM,{className:(0,c.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),(0,n.jsx)(W,{})]})})});H.displayName=E.UC.displayName,o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(E.JU,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...o})}).displayName=E.JU.displayName;let G=o.forwardRef((e,t)=>{let{className:a,children:o,...r}=e;return(0,n.jsxs)(E.q7,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...r,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(E.VF,{children:(0,n.jsx)(L.A,{className:"h-4 w-4"})})}),(0,n.jsx)(E.p4,{children:o})]})});G.displayName=E.q7.displayName,o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(E.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...o})}).displayName=E.wv.displayName;var J=a(6406),Z=a(7223),K=a(59),X=a(8065),Y=a(9613);let Q=Y.Kq,$=Y.bL,ee=Y.l9,et=o.forwardRef((e,t)=>{let{className:a,sideOffset:o=4,...r}=e;return(0,n.jsx)(Y.UC,{ref:t,sideOffset:o,className:(0,c.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});et.displayName=Y.UC.displayName;let ea=["sine","triangle","square","sawtooth"],en=["cool","hot"],eo=["rapid","high","mid","low"],er=["high","mid","low"],es=e=>"".concat((100*e).toFixed(0),"%"),el=e=>"".concat(e.toFixed(2),"s"),ei=e=>{let{selectedBlock:t,selectedChannelType:a,onUpdateBlock:o,onDeleteBlock:r,className:s}=e;if(!t)return(0,n.jsxs)(M,{className:(0,c.cn)("p-6 flex flex-col items-center justify-center text-center bg-muted/30 shadow-lg transition-all duration-300 ease-in-out min-h-[400px]",s),children:[(0,n.jsxs)(B,{children:[(0,n.jsx)(J.A,{className:"h-16 w-16 text-primary mx-auto mb-4"}),(0,n.jsx)(D,{className:"text-xl text-foreground/80",children:"Block Properties"})]}),(0,n.jsxs)(I,{children:[(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a block from a channel's timeline to view and edit its properties here."}),(0,n.jsx)("img",{src:"https://placehold.co/200x150.png?text=Select+Block",alt:"Placeholder for property panel","data-ai-hint":"music interface abstract",className:"mt-4 rounded-md opacity-50"})]})]});let l=()=>{t&&r(t.id)};if("audio"===a&&"isSilent"in t&&t.isSilent)return(0,n.jsx)(M,{className:(0,c.cn)("p-1 bg-gradient-to-br from-slate-500/10 via-slate-400/10 to-slate-300/10 shadow-xl transition-all duration-300 ease-in-out min-h-[400px]",s),children:(0,n.jsxs)(I,{className:"p-5 bg-card rounded-md h-full flex flex-col",children:[(0,n.jsxs)(B,{className:"p-0 mb-4",children:[(0,n.jsxs)(D,{className:"text-2xl font-semibold text-gradient-primary-accent-secondary flex items-center",children:[(0,n.jsx)(N.A,{className:"mr-2 h-6 w-6"})," Silent Block"]}),(0,n.jsx)(F,{className:"text-sm",children:"Adjust the duration of this silence."})]}),(0,n.jsx)("div",{className:"space-y-6 flex-grow",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)(p,{htmlFor:"duration-silent",className:"text-sm font-medium",children:["Duration (",t.duration.toFixed(1)," s)"]}),(0,n.jsx)(y,{id:"duration-silent",min:.1,max:10,step:.1,value:[t.duration],onValueChange:e=>o({...t,duration:e[0],blockRenderType:"audio"}),className:"mt-2"})]})}),(0,n.jsxs)(u,{onClick:l,variant:"destructive",className:"w-full mt-auto",children:[(0,n.jsx)(Z.A,{className:"mr-2 h-4 w-4"})," Delete Block"]})]})});if("audio"===a&&"waveform"in t){let e=(e,a)=>{o({...t,[e]:a,blockRenderType:"audio"})},a=(t,a)=>{e(t,a[0])},r=(e,t,a)=>(0,n.jsx)(Q,{delayDuration:300,children:(0,n.jsxs)($,{children:[(0,n.jsx)(ee,{asChild:!0,children:a}),(0,n.jsxs)(et,{children:[(0,n.jsx)("p",{className:"font-semibold",children:e}),(0,n.jsx)("p",{className:"text-xs",children:t})]})]})});return(0,n.jsx)(M,{className:(0,c.cn)("p-1 bg-gradient-to-br from-accent/10 via-secondary/10 to-primary/10 shadow-xl transition-all duration-300 ease-in-out min-h-[400px]",s),children:(0,n.jsxs)(I,{className:"p-5 bg-card rounded-md h-full flex flex-col",children:[(0,n.jsxs)(B,{className:"p-0 mb-4",children:[(0,n.jsx)(D,{className:"text-2xl font-semibold text-gradient-primary-accent-secondary",children:"Audio Block Properties"}),(0,n.jsx)(F,{className:"text-sm",children:"Adjust the selected audio block."})]}),(0,n.jsxs)("div",{className:"space-y-5 flex-grow overflow-y-auto pr-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(p,{htmlFor:"waveform",className:"text-sm font-medium",children:"Waveform"}),(0,n.jsxs)(U,{value:t.waveform,onValueChange:t=>e("waveform",t),children:[(0,n.jsx)(_,{id:"waveform",className:"mt-1",children:(0,n.jsx)(z,{placeholder:"Select waveform"})}),(0,n.jsx)(H,{children:ea.map(e=>(0,n.jsx)(G,{value:e,className:"capitalize",children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(p,{htmlFor:"frequency",className:"text-sm font-medium",children:["Frequency (",t.frequency.toFixed(0)," Hz)"]}),(0,n.jsx)(y,{id:"frequency",min:10,max:300,step:1,value:[t.frequency],onValueChange:e=>a("frequency",e),className:"mt-2 data-[state=active]:ring-primary"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(p,{htmlFor:"duration-audible",className:"text-sm font-medium",children:["Duration (",el(t.duration),")"]}),(0,n.jsx)(y,{id:"duration-audible",min:.1,max:10,step:.01,value:[t.duration],onValueChange:e=>a("duration",e),className:"mt-2"})]}),(0,n.jsxs)("div",{className:"space-y-1 pt-2 border-t mt-4",children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Envelope (ADSR)"}),(0,n.jsxs)("div",{children:[r("Fade In (Attack)","Time for sound to reach full volume.",(0,n.jsxs)(p,{htmlFor:"attack",className:"text-xs font-medium flex items-center",children:[(0,n.jsx)("span",{className:"mr-1 text-base",children:"↗️"}),"Fade In (",el(t.attack),", ",t.duration>0?es(t.attack/t.duration):"N/A",")"]})),(0,n.jsx)(y,{id:"attack",min:0,max:t.duration,step:.01,value:[t.attack],onValueChange:e=>a("attack",e),className:"mt-1"})]}),(0,n.jsxs)("div",{children:[r("Volume Drop (Decay)","Time for sound to drop to sustain level.",(0,n.jsxs)(p,{htmlFor:"decay",className:"text-xs font-medium flex items-center",children:[(0,n.jsx)("span",{className:"mr-1 text-base",children:"↘️"}),"Volume Drop (",el(t.decay),", ",t.duration>0?es(t.decay/t.duration):"N/A",")"]})),(0,n.jsx)(y,{id:"decay",min:0,max:t.duration,step:.01,value:[t.decay],onValueChange:e=>a("decay",e),className:"mt-1"})]}),(0,n.jsxs)("div",{children:[r("Hold Level (Sustain)","Volume level while the sound is held.",(0,n.jsxs)(p,{htmlFor:"sustainLevel",className:"text-xs font-medium flex items-center",children:[(0,n.jsx)("span",{className:"mr-1 text-base",children:"➡️"}),"Hold Level (",es(t.sustainLevel),")"]})),(0,n.jsx)(y,{id:"sustainLevel",min:0,max:1,step:.01,value:[t.sustainLevel],onValueChange:e=>a("sustainLevel",e),className:"mt-1"})]}),(0,n.jsxs)("div",{children:[r("Fade Out (Release)","Time for sound to fade to silence at the end.",(0,n.jsxs)(p,{htmlFor:"release",className:"text-xs font-medium flex items-center",children:[(0,n.jsx)("span",{className:"mr-1 text-base",children:"↘️"}),"Fade Out (",el(t.release),", ",t.duration>0?es(t.release/t.duration):"N/A",")"]})),(0,n.jsx)(y,{id:"release",min:0,max:t.duration,step:.01,value:[t.release],onValueChange:e=>a("release",e),className:"mt-1"})]})]})]}),(0,n.jsxs)(u,{onClick:l,variant:"destructive",className:"w-full mt-auto pt-3",children:[(0,n.jsx)(Z.A,{className:"mr-2 h-4 w-4"})," Delete Block"]})]})})}if("thermal"===a&&"type"in t){let e="cool"===t.type?eo:er,a=(e,a)=>{let n={...t,[e]:a,blockRenderType:"temperature"};"type"===e&&"hot"===a&&"rapid"===t.intensity&&(n.intensity="low"),o(n)};return(0,n.jsx)(M,{className:(0,c.cn)("p-1 bg-gradient-to-br from-sky-500/10 via-orange-400/10 to-red-500/10 shadow-xl transition-all duration-300 ease-in-out min-h-[400px]",s),children:(0,n.jsxs)(I,{className:"p-5 bg-card rounded-md h-full flex flex-col",children:[(0,n.jsxs)(B,{className:"p-0 mb-4",children:[(0,n.jsxs)(D,{className:"text-2xl font-semibold text-gradient-primary-accent-secondary flex items-center",children:["cool"===t.type?(0,n.jsx)(K.A,{className:"mr-2 h-6 w-6 text-blue-500"}):(0,n.jsx)(X.A,{className:"mr-2 h-6 w-6 text-orange-500"}),"Temperature Block"]}),(0,n.jsx)(F,{className:"text-sm",children:"Adjust temperature settings."})]}),(0,n.jsxs)("div",{className:"space-y-6 flex-grow",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(p,{htmlFor:"temperature-mode",className:"text-sm font-medium",children:"Mode"}),(0,n.jsxs)(U,{value:t.type,onValueChange:e=>a("type",e),children:[(0,n.jsx)(_,{id:"temperature-mode",className:"mt-1",children:(0,n.jsx)(z,{placeholder:"Select mode"})}),(0,n.jsx)(H,{children:en.map(e=>(0,n.jsx)(G,{value:e,className:"capitalize",children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(p,{className:"text-sm font-medium",children:"Intensity"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-1",children:e.map(e=>(0,n.jsx)(u,{variant:t.intensity===e?"default":"outline",onClick:()=>a("intensity",e),className:"capitalize",children:e},e))})]}),(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(p,{children:"Duration (seconds)"}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(y,{min:0,max:15,step:.1,value:[t.duration],onValueChange:e=>a("duration",e[0]),className:"flex-grow"}),(0,n.jsxs)("span",{className:"text-sm w-12 text-right",children:[t.duration.toFixed(1),"s"]})]})]})})]}),(0,n.jsxs)(u,{onClick:l,variant:"destructive",className:"w-full mt-auto",children:[(0,n.jsx)(Z.A,{className:"mr-2 h-4 w-4"})," Delete Block"]})]})})}return(0,n.jsxs)(M,{className:(0,c.cn)("p-6 flex flex-col items-center justify-center text-center bg-muted/30 shadow-lg",s),children:[(0,n.jsx)(B,{children:(0,n.jsx)(D,{className:"text-xl text-foreground/80",children:"Invalid Block"})}),(0,n.jsx)(I,{children:(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"The selected block type is not recognized or doesn't match the channel type."})})]})};var ec=a(3152),ed=a(207),eu=a(8061),em=a(659);let eh={sine:ec.A,triangle:ed.A,square:eu.A,sawtooth:em.A},ep={sine:"from-blue-400 to-blue-600",triangle:"from-green-400 to-green-600",square:"from-red-400 to-red-600",sawtooth:"from-yellow-400 to-yellow-600"},ef=e=>{let{block:t,widthInPixels:a}=e,{duration:o,attack:r,decay:s,sustainLevel:l,release:i}=t;if(o<=0)return null;let c=(1-l)*20,d=Math.max(0,Math.min(r/o*a,a)),u=Math.max(d,Math.min((r+s)/o*a,a)),m=Math.max(u,Math.min((o-i)/o*a,a)),h=Math.max(m,Math.min(o/o*a,a)),p="M ".concat(0,",").concat(20," L ").concat(d,",").concat(0," L ").concat(u,",").concat(c," L ").concat(m,",").concat(c," L ").concat(h,",").concat(20);return(0,n.jsx)("svg",{width:"100%",height:20,viewBox:"0 0 ".concat(a," ").concat(20),preserveAspectRatio:"none",className:"absolute bottom-1 left-0 w-full pointer-events-none",style:{opacity:.33},children:(0,n.jsx)("path",{d:p,fill:"currentColor",stroke:"currentColor",strokeWidth:"0.5"})})},ex=e=>{let{block:t,isSelected:a,onClick:r,pixelsPerSecond:s,heightInRem:l=6,className:i,channelId:d}=e,[u,m]=(0,o.useState)(!1),h=(Number(t.duration)||0)*s,p="".concat(l,"rem"),f=e=>{e.dataTransfer.setData("application/json",JSON.stringify({blockId:t.id,sourceChannelId:d,blockType:"audio"})),e.dataTransfer.effectAllowed="move",m(!0),e.currentTarget.setAttribute("data-block-id",t.id)},x=()=>{m(!1)};if(t.isSilent)return(0,n.jsxs)(M,{draggable:!0,onDragStart:f,onDragEnd:x,"data-block-id":t.id,className:(0,c.cn)("flex flex-col justify-between cursor-pointer transition-all duration-200 ease-in-out shadow-md hover:shadow-lg relative group",a?"ring-2 ring-primary ring-offset-2 shadow-xl scale-105":"hover:scale-[1.02]",u?"opacity-50 ring-2 ring-accent scale-105":"","bg-gradient-to-br ".concat("from-slate-300 to-slate-500"," text-white"),i),style:{width:"".concat(h,"px"),minWidth:"".concat(Math.max(.25*s,30),"px"),height:p,boxSizing:"border-box"},onClick:r,role:"button","aria-pressed":a,"aria-label":"Silent block, ".concat(t.duration,"s"),children:[(0,n.jsxs)(B,{className:"p-1.5 flex-row items-center justify-between space-y-0",children:[(0,n.jsx)(D,{className:"text-xs font-medium truncate",children:"Silence"}),(0,n.jsx)(N.A,{className:"h-3 w-3 text-white/80"})]}),(0,n.jsxs)(I,{className:"p-1.5 text-center flex-grow flex flex-col justify-center",children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:"-"}),(0,n.jsxs)("p",{className:"text-xs opacity-80",children:[t.duration.toFixed(1)," s"]})]})]});let g=eh[t.waveform],y=ep[t.waveform]||"from-gray-400 to-gray-600";return(0,n.jsxs)(M,{draggable:!0,onDragStart:f,onDragEnd:x,"data-block-id":t.id,className:(0,c.cn)("flex flex-col justify-between cursor-pointer transition-all duration-200 ease-in-out shadow-md hover:shadow-lg relative group overflow-hidden",a?"ring-2 ring-primary ring-offset-2 shadow-xl scale-105":"hover:scale-[1.02]",u?"opacity-50 ring-2 ring-accent scale-105":"","bg-gradient-to-br ".concat(y," text-white"),i),style:{width:"".concat(h,"px"),minWidth:"".concat(Math.max(.25*s,30),"px"),height:p,boxSizing:"border-box"},onClick:r,role:"button","aria-pressed":a,"aria-label":"Audio block: ".concat(t.waveform,", ").concat(t.frequency,"Hz, ").concat(t.duration,"s"),children:[(0,n.jsxs)(B,{className:"p-1.5 flex-row items-center justify-between space-y-0 z-10",children:[(0,n.jsx)(D,{className:"text-xs font-medium truncate",children:t.waveform.charAt(0).toUpperCase()+t.waveform.slice(1)}),(0,n.jsx)(g,{className:"h-3 w-3 text-white/80"})]}),(0,n.jsxs)(I,{className:"p-1.5 text-center flex-grow flex flex-col justify-center z-10",children:[(0,n.jsxs)("p",{className:"text-sm font-semibold",children:[t.frequency," Hz"]}),(0,n.jsxs)("p",{className:"text-xs opacity-80",children:[t.duration.toFixed(1)," s"]})]}),h>0&&(0,n.jsx)(ef,{block:t,widthInPixels:h})]})},eg=e=>{let{block:t,pixelsPerSecond:a,heightInRem:r=6,isSelected:s,onClick:l,className:i,channelId:d}=e,[u,m]=(0,o.useState)(!1),h=(Number(t.duration)||0)*a,p="cool"===t.type?K.A:X.A,f="cool"===t.type?"from-sky-400 to-sky-600":"from-orange-400 to-orange-600";return(0,n.jsxs)("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.setData("application/json",JSON.stringify({blockId:t.id,sourceChannelId:d,blockType:"thermal"})),e.dataTransfer.effectAllowed="move",m(!0),e.currentTarget.setAttribute("data-block-id",t.id)},onDragEnd:()=>{m(!1)},"data-block-id":t.id,className:(0,c.cn)("flex flex-col justify-between items-center cursor-pointer transition-all duration-200 ease-in-out shadow-md hover:shadow-lg relative group overflow-hidden text-white p-1.5 rounded-md","bg-gradient-to-br ".concat(f),s?"ring-2 ring-primary ring-offset-2 shadow-xl scale-105":"hover:scale-[1.02]",u?"opacity-50 ring-2 ring-accent scale-105":"",i),style:{width:"".concat(h,"px"),minWidth:"".concat(Math.max(.25*a,30),"px"),height:"".concat(r,"rem"),boxSizing:"border-box"},onClick:l,role:"button","aria-pressed":!!s,"aria-label":"Temperature block: ".concat(t.type," ").concat(t.intensity,", ").concat(Number(t.duration).toFixed(1),"s"),children:[(0,n.jsxs)("div",{className:"w-full flex justify-between items-center text-xs",children:[(0,n.jsx)("span",{className:"font-medium truncate capitalize",children:t.type}),(0,n.jsx)(p,{className:"h-3 w-3 text-white/80"})]}),(0,n.jsxs)("div",{className:"text-center flex-grow flex flex-col justify-center",children:[(0,n.jsx)("p",{className:"text-sm font-semibold capitalize",children:t.intensity}),(0,n.jsxs)("p",{className:"text-xs opacity-80",children:[Number(t.duration).toFixed(1),"s"]})]})]})};var ey=a(7655);let ev=o.forwardRef((e,t)=>{let{className:a,children:o,...r}=e;return(0,n.jsxs)(ey.bL,{ref:t,className:(0,c.cn)("relative overflow-hidden",a),...r,children:[(0,n.jsx)(ey.LM,{className:"h-full w-full rounded-[inherit]",children:o}),(0,n.jsx)(eb,{}),(0,n.jsx)(ey.OK,{})]})});ev.displayName=ey.bL.displayName;let eb=o.forwardRef((e,t)=>{let{className:a,orientation:o="vertical",...r}=e;return(0,n.jsx)(ey.VM,{ref:t,orientation:o,className:(0,c.cn)("flex touch-none select-none transition-colors","vertical"===o&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===o&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...r,children:(0,n.jsx)(ey.lr,{className:"relative flex-1 rounded-full bg-border"})})});eb.displayName=ey.VM.displayName;let eN=o.forwardRef((e,t)=>{let{className:a,type:o,...r}=e;return(0,n.jsx)("input",{type:o,className:(0,c.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});eN.displayName="Input";var ew=a(6372),ej=a(8127),ek=a(1949),eA=a(6318),eS=a(5318),eC=a(5222),eT=a(6273);let eP="PebbleFeel",eM={PFService:"5df89308-0b98-11eb-adc1-0242ac120002"},eB={Write:"8eb21104-0b98-11eb-adc1-0242ac120002"},eD={ON:new Uint8Array([53,53,97,48,101,48,56,48,48,48,48,49,48,48,97,97,13,10]),OFF:new Uint8Array([53,53,97,48,101,48,56,48,48,48,48,48,48,48,97,98,13,10]),CoolRapid:new Uint8Array([53,53,97,48,101,48,57,48,48,48,48,53,48,48,57,54,13,10]),CoolHigh:new Uint8Array([53,53,97,48,101,48,57,48,48,48,48,52,48,48,57,55,13,10]),CoolMid:new Uint8Array([53,53,97,48,101,48,57,48,48,48,48,51,48,48,57,56,13,10]),CoolLow:new Uint8Array([53,53,97,48,101,48,57,48,48,48,48,50,48,48,57,57,13,10]),HotHigh:new Uint8Array([53,53,97,48,101,48,57,48,48,48,48,56,48,48,57,51,13,10]),HotMid:new Uint8Array([53,53,97,48,101,48,57,48,48,48,48,55,48,48,57,52,13,10]),HotLow:new Uint8Array([53,53,97,48,101,48,57,48,48,48,48,54,48,48,57,53,13,10])},eF=function(){let e=null,t=null,a=null,n=!1,o=null,r=null,s=function(e,t){for(var a=arguments.length,n=Array(a>2?a-2:0),o=2;o<a;o++)n[o-2]=arguments[o];"string"==typeof e&&e.length<3?console.log("[BluetoothManager] ".concat(e),t,...n):console.log("[BluetoothManager]",e,t,...n)},l=function(e,t){for(var a=arguments.length,n=Array(a>2?a-2:0),o=2;o<a;o++)n[o-2]=arguments[o];"string"==typeof e&&e.length<3?console.warn("[BluetoothManager] ".concat(e),t,...n):console.warn("[BluetoothManager]",e,t,...n)},i=function(e,t){for(var a=arguments.length,n=Array(a>2?a-2:0),o=2;o<a;o++)n[o-2]=arguments[o];"string"==typeof e&&e.length<3?console.error("[BluetoothManager] ".concat(e),t,...n):console.error("[BluetoothManager]",e,t,...n)},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n=e,o=e?t:null,s("ℹ️","Connection status updated: ".concat(e?"Connected":"Disconnected").concat(t?" to "+t:"")),r)try{r(n,o)}catch(e){i("❗","Error in connectionStatusCallback:",e)}},d=n=>{let o=n&&n.target?n.target.name:e?e.name:"Unknown Device";s("\uD83D\uDD0C","Device disconnected via GATT event: ".concat(o)),e&&e.removeEventListener&&e.removeEventListener("gattserverdisconnected",d),e=null,t=null,a=null,c(!1,null)};return{connectDevice:async()=>{if("undefined"==typeof navigator||!navigator.bluetooth)return i("❗","Web Bluetooth API is not available in this environment."),{success:!1,error:"not_supported",message:"Web Bluetooth API is not available in this browser."};if(n)return s("✅","Device already connected:",o),{success:!0,deviceName:o};let r=null;try{s("\uD83D\uDD35",'Scanning for PebbleFeel devices (name filter: "'+eP+'")...');let n=await navigator.bluetooth.requestDevice({filters:[{name:eP}],optionalServices:[eM.PFService]});if(!n)return s("\uD83D\uDFE1","No device selected by user (requestDevice returned null)."),{success:!1,error:"cancelled",message:"Device selection cancelled or no device found."};let l=(r=n).name||"PebbleFeel-ABC123 (Mock Name)";s("\uD83D\uDD35","Device found: ".concat(l," (Actual ID: ").concat(r.id,")")),s("\uD83D\uDD35","Connecting to GATT Server on '".concat(l,"'...")),r.addEventListener("gattserverdisconnected",d),t=await r.gatt.connect(),s("\uD83D\uDD35","Connected to GATT Server on '".concat(l,"'.")),s("\uD83D\uDD35","Getting Primary Service (UUID: ".concat(eM.PFService,")..."));let i=await t.getPrimaryService(eM.PFService);return s("\uD83D\uDD35","Primary Service obtained."),s("\uD83D\uDD35","Getting Write Characteristic (UUID: ".concat(eB.Write,")...")),a=await i.getCharacteristic(eB.Write),s("\uD83D\uDD35","Write Characteristic obtained. PebbleFeel Service Ready!"),e=r,o=l,c(!0,o),{success:!0,deviceName:o}}catch(a){r&&r.removeEventListener&&r.removeEventListener("gattserverdisconnected",d),r&&r.gatt&&r.gatt.connected?(s("\uD83D\uDFE1","Cleaning up partially connected GATT server..."),r.gatt.disconnect()):d({target:r||{name:"Attempted Device"}});let e="connection_failed",t=a.message||"Unknown connection error.";return"SecurityError"===a.name?(e="security_error",t="Access to Bluetooth feature disallowed by permissions policy. This often happens in sandboxed environments like iframes. Try opening the app in a new tab or window.",l("\uD83D\uDD12","Connection failed due to SecurityError: ".concat(a.message,". This is often due to iframe restrictions. Ensure the app is run in a top-level context."))):"NotFoundError"===a.name?(e="not_found",t="PebbleFeel device not found or selection cancelled. Ensure it is discoverable and in range.",s("\uD83D\uDFE1","NotFoundError during device request (user cancellation or no device found): ".concat(a.message))):"NotAllowedError"===a.name?(e="not_allowed",t="Bluetooth permission denied or feature disabled by user/browser.",i("\uD83D\uDEAB","NotAllowedError during device request: ".concat(a.message))):i("❗","Unhandled error during connectDevice: ".concat(a.name," - ").concat(a.message)),{success:!1,error:e,message:t}}},disconnectDevice:async()=>{e&&e.gatt&&e.gatt.connected?(s("\uD83D\uDD35","Disconnecting from device:",e.name),e.gatt.disconnect()):(s("\uD83D\uDFE1","No active connection to disconnect or device already disconnected."),n&&d({target:e||{name:"Previously Connected Device"}}))},sendTemperatureCommand:async(e,t,o)=>{let r;if(s("\uD83C\uDF21️","Attempting sendTemperatureCommand:"),s("  Mode:",e),s("  Intensity:",t),s("  Duration (for app timing):",o+"s"),!n||!a)return i("❗","Cannot send command: Not connected or characteristic not available."),s("  Status: Failed (Not Connected)"),!1;let l="".concat(e.toUpperCase()," ").concat(t.toUpperCase());if("cool"===e)switch(t){case"rapid":r=eD.CoolRapid;break;case"high":r=eD.CoolHigh;break;case"mid":r=eD.CoolMid;break;case"low":r=eD.CoolLow;break;default:return i("❗","Invalid cool intensity:",t),s("  Status: Failed (Invalid Intensity)"),!1}else if("hot"!==e)return i("❗","Invalid temperature mode:",e),s("  Status: Failed (Invalid Mode)"),!1;else switch(t){case"high":r=eD.HotHigh;break;case"mid":r=eD.HotMid;break;case"low":r=eD.HotLow;break;default:return i("❗","Invalid hot intensity:",t),s("  Status: Failed (Invalid Intensity)"),!1}let c=Array.from(r).map(e=>"0x"+e.toString(16).padStart(2,"0")).join(" ");s("  Command Name:",l),s("  Raw Bytes to Send:",c);try{return s("  Simulating: characteristic.writeValueWithoutResponse(...)"),await a.writeValueWithoutResponse(r),s("  Status: Command sent successfully."),!0}catch(e){return i("❗","Error sending temperature command (".concat(l,"):"),e.name,e.message),s("  Status: Failed (Write Error)"),!1}},turnOffEffect:async()=>{if(s("\uD83C\uDF21️","Attempting turnOffEffect (send OFF command):"),!n||!a)return i("❗","Cannot send OFF command: Not connected or characteristic not available."),s("  Status: Failed (Not Connected)"),!1;let e=Array.from(eD.OFF).map(e=>"0x"+e.toString(16).padStart(2,"0")).join(" ");s("  Command Name: OFF"),s("  Raw Bytes to Send:",e);try{return s("  Simulating: characteristic.writeValueWithoutResponse(OFF_COMMAND)"),await a.writeValueWithoutResponse(eD.OFF),s("  Status: OFF Command sent successfully."),!0}catch(e){return i("❗","Error sending OFF command:",e.name,e.message),s("  Status: Failed (Write Error)"),!1}},getConnectionStatus:()=>({isConnected:n,deviceName:o}),onConnectionChanged:e=>{"function"==typeof e?(r=e,s("ℹ️","Connection status callback registered.")):i("❗","Provided callback for onConnectionChanged is not a function.")}}}();var eI=a(7481);let eR=e=>{let{channel:t,isSelected:a,selectedBlockId:r,onSelectChannel:s,onUpdateChannel:l,onSelectBlock:i,onReorderBlock:d,onDeleteChannelRequest:m,pixelsPerSecond:h}=e,[p,f]=(0,o.useState)(!1),[x,g]=(0,o.useState)(t.name),b=(0,o.useRef)(null),{toast:j}=(0,eI.dj)(),[k,A]=(0,o.useState)("idle"),[S,C]=(0,o.useState)(null),T=(0,o.useRef)(!1);(0,o.useEffect)(()=>{if(T.current=!0,"thermal"===t.channelType){let e=eF.getConnectionStatus();T.current&&(A(e.isConnected?"connected":"idle"),C(e.deviceName)),eF.onConnectionChanged((e,t)=>{T.current&&(A(e?"connected":"connecting"!==k||e?"idle":"error"),C(t||null))})}return()=>{T.current=!1}},[t.channelType,j,k]);let B=()=>{""!==x.trim()?l(t.id,{name:x.trim()}):g(t.name),f(!1)},F=()=>{g(t.name),f(!1)},I=(0,o.useMemo)(()=>"audio"===t.channelType?t.audioBlocks.map(e=>({...e,blockRenderType:"audio"})):"thermal"===t.channelType?t.temperatureBlocks.map(e=>({...e,blockRenderType:"temperature"})):[],[t]),R="audio"===t.channelType?ew.A:w.A,E=(0,o.useCallback)(async()=>{if("thermal"!==t.channelType)return;if("connected"===k){A("disconnecting"),await eF.disconnectDevice(),j({title:"PebbleFeel Disconnecting..."});return}if("undefined"==typeof navigator||!("bluetooth"in navigator)){j({title:"Bluetooth Not Supported",description:"Web Bluetooth is not available in this browser.",variant:"destructive"}),T.current&&A("error");return}T.current&&A("connecting");let e=await eF.connectDevice();if(T.current){if(e.success)j({title:"PebbleFeel Connected",description:"Device: ".concat(e.deviceName)});else{A("error");let t="Failed to connect to PebbleFeel.";"cancelled"===e.error?t="Device selection cancelled by user.":"not_found"===e.error?t="PebbleFeel device not found. Ensure it's on and in range.":"not_allowed"===e.error?t="Bluetooth permission denied. Please allow Bluetooth access in your browser.":"security_error"===e.error?t="Bluetooth access is restricted by browser security policy (e.g., in an iframe). Try opening the app in a new tab or window.":e.message&&(t="Failed to connect: ".concat(e.message)),j({title:"Connection Failed",description:t,variant:"destructive"})}}},[t.channelType,j,k]),O=(()=>{switch(k){case"connecting":return{text:"Connecting...",Icon:v.A,variant:"outline",className:"text-yellow-500 animate-spin",disabled:!0,tooltip:"Attempting to connect..."};case"connected":return{text:S||"Connected",Icon:ej.A,variant:"default",className:"bg-green-500 hover:bg-green-600 text-white",disabled:!1,tooltip:"Connected to ".concat(S||"PebbleFeel",". Click to disconnect.")};case"error":return{text:"Connection Failed",Icon:ek.A,variant:"destructive",className:"",disabled:!1,tooltip:"Connection failed. Click to retry."};case"disconnecting":return{text:"Disconnecting...",Icon:v.A,variant:"outline",className:"text-orange-500 animate-spin",disabled:!0,tooltip:"Disconnecting..."};default:return{text:"Connect PebbleFeel",Icon:eA.A,variant:"outline",className:"text-blue-500 hover:bg-blue-500/10",disabled:!1,tooltip:"Connect to PebbleFeel device"}}})();return(0,n.jsxs)(M,{className:(0,c.cn)("flex flex-col p-3 transition-all duration-200 ease-in-out h-[170px]",a?"ring-2 ring-primary shadow-lg bg-muted/50":"bg-muted/20 hover:bg-muted/30"),onClick:()=>s(t.id),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2 px-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-grow min-w-0",children:[(0,n.jsx)(R,{className:(0,c.cn)("h-5 w-5 shrink-0","audio"===t.channelType?"text-blue-500":"text-orange-500")}),p?(0,n.jsxs)("div",{className:"flex items-center gap-1 flex-grow min-w-0",children:[(0,n.jsx)(eN,{type:"text",value:x,onChange:e=>{g(e.target.value)},onBlur:B,onKeyDown:e=>{"Enter"===e.key&&B(),"Escape"===e.key&&F()},className:"h-8 text-sm flex-grow",autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,n.jsx)(u,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),B()},className:"h-8 w-8 shrink-0",children:(0,n.jsx)(L.A,{className:"h-4 w-4"})}),(0,n.jsx)(u,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),F()},className:"h-8 w-8 shrink-0",children:(0,n.jsx)(eS.A,{className:"h-4 w-4"})})]}):(0,n.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,n.jsx)(D,{className:"text-lg font-semibold hover:text-primary cursor-pointer truncate",onClick:e=>{e.stopPropagation(),f(!0)},children:t.name}),(0,n.jsx)(u,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),f(!0)},className:"h-6 w-6 p-0 shrink-0",children:(0,n.jsx)(eC.A,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 shrink-0 ml-auto",children:["thermal"===t.channelType&&(0,n.jsx)(Q,{delayDuration:100,children:(0,n.jsxs)($,{children:[(0,n.jsx)(ee,{asChild:!0,children:(0,n.jsxs)(u,{variant:O.variant,size:"sm",onClick:e=>{e.stopPropagation(),E()},disabled:O.disabled,className:(0,c.cn)("h-8 w-auto px-2",O.className),children:[(0,n.jsx)(O.Icon,{className:(0,c.cn)("h-4 w-4",O.text&&"mr-1.5")}),O.text]})}),(0,n.jsx)(et,{side:"top",children:(0,n.jsx)("p",{children:O.tooltip})})]})}),"audio"===t.channelType&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u,{variant:t.isMuted?"destructive":"outline",size:"icon",onClick:e=>{e.stopPropagation(),l(t.id,{isMuted:!t.isMuted})},className:"h-8 w-8",title:t.isMuted?"Unmute Channel":"Mute Channel",children:t.isMuted?(0,n.jsx)(N.A,{className:"h-4 w-4"}):(0,n.jsx)(eT.A,{className:"h-4 w-4"})}),(0,n.jsx)(P.A,{className:"h-5 w-5 text-muted-foreground"}),(0,n.jsx)(y,{min:0,max:1,step:.01,value:[t.volume],onValueChange:e=>l(t.id,{volume:e[0]}),className:"w-20 md:w-24",onClick:e=>e.stopPropagation(),"aria-label":"".concat(t.name," volume")}),(0,n.jsxs)("span",{className:"text-xs w-8 text-right",children:[Math.round(100*t.volume),"%"]})]}),(0,n.jsx)(u,{variant:"ghost",size:"icon",className:"h-7 w-7 p-0 text-muted-foreground hover:text-destructive",onClick:e=>{e.stopPropagation(),m(t.id)},title:"Delete Channel",children:(0,n.jsx)(Z.A,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)(ev,{className:"relative h-[122px] w-full whitespace-nowrap rounded-md border border-border bg-background/30 flex-grow",children:[(0,n.jsxs)("div",{ref:b,onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},onDrop:e=>{e.preventDefault();let a=e.dataTransfer.getData("application/json");if(!a)return;let{blockId:n,sourceChannelId:o,blockType:r}=JSON.parse(a);if(t.channelType!==r){console.warn("Cannot drop ".concat(r," block into ").concat(t.channelType," channel.")),j({title:"Drag & Drop Error",description:"Cannot move a ".concat(r," block to a ").concat(t.channelType," channel."),variant:"destructive"});return}if(!n||!b.current)return;let s=b.current,l=e.clientX,i=("audio"===t.channelType?t.audioBlocks:t.temperatureBlocks).length,c=Array.from(s.children);for(let e=0;e<c.length;e++){let t=c[e];if(!t.hasAttribute("draggable")||!t.dataset.blockId)continue;let a=t.getBoundingClientRect();if(l<a.left+a.width/2){i=e;break}}d(t.id,n,i)},className:"relative py-2 px-2 min-h-[calc(100%-1rem)] flex space-x-2 items-center",style:{width:Math.max(300,I.reduce((e,t)=>e+(Number(t.duration)||0)*h,0)+2*h)},children:[0===I.length&&(0,n.jsx)(n.Fragment,{}),I.map(e=>"audio"===e.blockRenderType?(0,n.jsx)(ex,{block:e,isSelected:e.id===r&&t.id===("audio"===t.channelType?t.id:null),onClick:a=>{a.stopPropagation(),i(t.id,e.id)},pixelsPerSecond:h,heightInRem:5,channelId:t.id},e.id):"temperature"===e.blockRenderType?(0,n.jsx)(eg,{block:e,isSelected:e.id===r&&t.id===("thermal"===t.channelType?t.id:null),onClick:a=>{a.stopPropagation(),i(t.id,e.id)},pixelsPerSecond:h,heightInRem:5,channelId:t.id},e.id):null)]}),(0,n.jsx)(eb,{orientation:"horizontal"})]})]})};var eE=a(4520);let eO=eE.bL;eE.l9;let eV=eE.ZL,eL=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(eE.hJ,{className:(0,c.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...o,ref:t})});eL.displayName=eE.hJ.displayName;let eU=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsxs)(eV,{children:[(0,n.jsx)(eL,{}),(0,n.jsx)(eE.UC,{ref:t,className:(0,c.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o})]})});eU.displayName=eE.UC.displayName;let ez=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,c.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};ez.displayName="AlertDialogHeader";let e_=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,c.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};e_.displayName="AlertDialogFooter";let eq=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(eE.hE,{ref:t,className:(0,c.cn)("text-lg font-semibold",a),...o})});eq.displayName=eE.hE.displayName;let eW=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(eE.VY,{ref:t,className:(0,c.cn)("text-sm text-muted-foreground",a),...o})});eW.displayName=eE.VY.displayName;let eH=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(eE.rc,{ref:t,className:(0,c.cn)(d(),a),...o})});eH.displayName=eE.rc.displayName;let eG=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(eE.ZD,{ref:t,className:(0,c.cn)(d({variant:"outline"}),"mt-2 sm:mt-0",a),...o})});eG.displayName=eE.ZD.displayName;let eJ=e=>({attack:.1*e,decay:.15*e,sustainLevel:.7,release:.1*e}),eZ=e=>{let{duration:t,attack:a,decay:n,sustainLevel:o,release:r}=e;t=Number(t)||0,a=Number(a)||0,n=Number(n)||0,r=Number(r)||0,o=Number(o)||0,a=Math.max(0,a),n=Math.max(0,n),r=Math.max(0,r),o=Math.max(0,Math.min(o,1));let s=(a=Math.min(a,t))+(n=Math.min(n,t))+(r=Math.min(r,t));if(t<=0)a=0,n=0,r=0,s=0;else{let e=Math.max(0,t-.05);if(s>e){if(e>0&&s>0){let t=e/s;a*=t,n*=t,r*=t}else a=0,n=0,r=Math.min(r,t),t>0&&0===r&&e<=0||(r=t>0&&e<=0?t:0)}}if((s=a+n+r)>t&&t>0){let e=t/s;a*=e,n*=e,r*=e}let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return parseFloat(e.toFixed(t))};return{...e,duration:l(t),attack:l(a),decay:l(n),sustainLevel:l(o,2),release:l(r)}};function eK(){let{audioContextStarted:e,startAudioContext:t}=(0,s.L)(),{toast:a}=(0,eI.dj)(),l={id:crypto.randomUUID(),name:"Audio Channel 1",channelType:"audio",volume:.75,isMuted:!1,audioBlocks:[],temperatureBlocks:[]},[i,c]=(0,o.useState)([l]),[d,m]=(0,o.useState)(l.id),[h,p]=(0,o.useState)(null),[f,x]=(0,o.useState)(!1),[g,y]=(0,o.useState)(!1),[v,b]=(0,o.useState)(0),[N,j]=(0,o.useState)(!1),[k,A]=(0,o.useState)("mixed"),[S,C]=(0,o.useState)(.75),[T,P]=(0,o.useState)(null),B=(0,o.useRef)(new Map),D=(0,o.useRef)(null),F=(0,o.useRef)(null),I=(0,o.useRef)(null),E=(0,o.useRef)(null),O=(0,o.useRef)({looping:!0,outputMode:!0,masterVolume:!0,channelVolume:!0}),V=i.find(e=>e.id===d)||null,L=(0,o.useMemo)(()=>V&&h?"audio"===V.channelType?V.audioBlocks.find(e=>e.id===h)||null:"thermal"===V.channelType&&V.temperatureBlocks.find(e=>e.id===h)||null:null,[V,h]);(0,o.useEffect)(()=>{e&&(!F.current||F.current.disposed?(console.log("[MusicSyncPage] useEffect (audioContextStarted): Creating MasterVolumeNode."),F.current=new r.fS(r.F4(S)).toDestination(),console.log("[MusicSyncPage] MasterVolumeNode created and connected to destination. Initial volume (dB):",F.current.volume.value,"Node details:",F.current)):(console.log("[MusicSyncPage] useEffect (audioContextStarted): MasterVolumeNode already exists. Ramping volume."),F.current.volume.rampTo(r.F4(S),.05)))},[e,S]),(0,o.useEffect)(()=>{F.current&&e&&!O.current.masterVolume&&(console.log("[MusicSyncPage] useEffect (masterVolume, audioContextStarted): Ramping master volume to",S),F.current.volume.rampTo(r.F4(S),.05)),O.current.masterVolume&&(O.current.masterVolume=!1)},[S,e]);let U=(0,o.useCallback)(async()=>{if(console.log("[MusicSyncPage] ensureAudioIsActive: Called. audioContextStarted (app state):",e,"Tone.context.state:",r._O.state),"running"===r._O.state&&e)return console.log("[MusicSyncPage] ensureAudioIsActive: Audio already active and app state reflects this."),!0;y(!0),console.log("[MusicSyncPage] ensureAudioIsActive: Set isActivatingAudio to true. Attempting to activate audio...");try{if(await t(),"running"===r._O.state)return console.log("[MusicSyncPage] ensureAudioIsActive: activateAudio() successful. Tone.context.state:",r._O.state),!0;if(console.warn('[MusicSyncPage] ensureAudioIsActive: activateAudio() did not result in "running" state. Current state:',r._O.state),console.log("[MusicSyncPage] ensureAudioIsActive: Making a direct Tone.start() attempt."),await r.ni(),"running"===r._O.state)return console.log("[MusicSyncPage] ensureAudioIsActive: Direct Tone.start() successful. Tone.context.state:",r._O.state),e||await t(),!0;return console.error("[MusicSyncPage] ensureAudioIsActive: Direct Tone.start() also failed. Current state:",r._O.state),a({title:"Audio Activation Failed",description:"Could not enable audio. Please interact with the page again or check browser permissions.",variant:"destructive"}),!1}catch(e){return console.error("[MusicSyncPage] ensureAudioIsActive: Error during audio activation:",e),a({title:"Audio Initialization Error",description:String(e),variant:"destructive"}),!1}finally{y(!1),console.log("[MusicSyncPage] ensureAudioIsActive: Set isActivatingAudio to false.")}},[t,e,a]),z=async()=>{try{if(!await U()){console.error("[MusicSyncPage] testAudio: Audio context could not be started/ensured. Aborting test."),a({title:"Audio Test Failed",description:"Audio context could not be started.",variant:"destructive"});return}console.log("[MusicSyncPage] testAudio: Audio context state after ensureAudioIsActive:",r._O.state);let e=new r.RG().toDestination();console.log("[MusicSyncPage] testAudio: Synth created and connected to destination."),e.triggerAttackRelease("C4","8n",r.tB()),console.log("[MusicSyncPage] testAudio: Test note C4 triggered."),a({title:"Audio Test",description:"Playing C4 note. Did you hear it?"})}catch(e){console.error("[MusicSyncPage] testAudio: Audio test failed:",e),a({title:"Audio Test Failed",description:String(e),variant:"destructive"})}},_=(0,o.useCallback)(e=>{C(Math.max(0,Math.min(1,e)))},[]),q=(0,o.useCallback)(e=>{let t=0;return e.map(e=>{let a=Number(e.duration);if(isNaN(a)||a<0)return console.warn("[MusicSyncPage] recalculateChannelBlockStartTimes: Invalid duration (".concat(e.duration,") for block ").concat(e.id,". Treating as 0.")),{...e,startTime:t,duration:0};let n=t;return t+=a,{...e,startTime:n}})},[]),W=(0,o.useCallback)(e=>{let t=0;return e.map(e=>{let a=Number(e.duration);if(isNaN(a)||a<0)return console.warn("[MusicSyncPage] recalculateTemperatureBlockStartTimes: Invalid duration (".concat(e.duration,") for block ").concat(e.id,". Treating as 0.")),{...e,startTime:t,duration:0,blockRenderType:"temperature"};let n=t;return t+=a,{...e,startTime:n,blockRenderType:"temperature"}})},[]),H=(0,o.useCallback)(async()=>{if(!await U())return;let e=crypto.randomUUID(),t={id:e,name:"Audio Channel ".concat(i.filter(e=>"audio"===e.channelType).length+1),channelType:"audio",volume:.75,isMuted:!1,audioBlocks:[],temperatureBlocks:[]};c(e=>[...e,t]),m(e),p(null),a({title:"Audio Channel Added",description:"New ".concat(t.name," created.")})},[i,a,U]),G=(0,o.useMemo)(()=>i.some(e=>"thermal"===e.channelType),[i]),J=(0,o.useCallback)(async()=>{if(G){a({title:"Limit Reached",description:"Only one thermal channel is allowed. Please delete the existing thermal channel first.",variant:"destructive"});return}if(!await U())return;let e=crypto.randomUUID(),t={id:e,name:"Thermal Channel ".concat(i.filter(e=>"thermal"===e.channelType).length+1),channelType:"thermal",volume:0,isMuted:!0,audioBlocks:[],temperatureBlocks:[]};c(e=>[...e,t]),m(e),p(null),a({title:"Thermal Channel Added",description:"New ".concat(t.name," created.")})},[i,a,U,G]),Z=e=>{if(i.length<=1){a({title:"Cannot Delete Channel",description:"The project must have at least one channel.",variant:"destructive"});return}let t=i.find(t=>t.id===e);t&&P(t)},K=(0,o.useCallback)(e=>{m(e),p(null)},[]),X=(0,o.useCallback)((e,t)=>{c(a=>a.map(a=>a.id===e?{...a,...t}:a));let n=i.find(t=>t.id===e);if(!n)return;let o=n.name||"Channel";void 0===t.volume||O.current.channelVolume||"audio"!==n.channelType?void 0!==t.volume&&O.current.channelVolume&&(O.current.channelVolume=!1):a({title:"Channel Volume Changed",description:"".concat(o," volume to ").concat(Math.round(100*t.volume),"%")}),void 0!==t.isMuted&&"audio"===n.channelType&&a({title:"Channel ".concat(t.isMuted?"Muted":"Unmuted"),description:"".concat(o," is now ").concat(t.isMuted?"muted":"unmuted",".")})},[a,i,d]),Y=(0,o.useCallback)(async()=>{if(!await U())return;if(!d||(null==V?void 0:V.channelType)!=="audio"){a({title:"Cannot Add Audio Block",description:"Please select an audio channel first.",variant:"destructive"});return}let e=crypto.randomUUID(),t={id:e,waveform:"sine",frequency:220,duration:2,startTime:0,isSilent:!1,...eJ(2)};t=eZ(t),c(e=>e.map(e=>{if(e.id===d){let a=[...e.audioBlocks,t];return{...e,audioBlocks:q(a)}}return e})),p(e),a({title:"Audio Block Added",description:"Block added to ".concat(null==V?void 0:V.name,".")})},[d,V,q,a,U]),Q=(0,o.useCallback)(async()=>{if(!await U())return;if(!d||(null==V?void 0:V.channelType)!=="audio"){a({title:"Cannot Add Silence Block",description:"Please select an audio channel first.",variant:"destructive"});return}let e=crypto.randomUUID(),t={id:e,duration:1,startTime:0,isSilent:!0};c(e=>e.map(e=>{if(e.id===d){let a=[...e.audioBlocks,t];return{...e,audioBlocks:q(a)}}return e})),p(e),a({title:"Silence Block Added",description:"Silence added to ".concat(null==V?void 0:V.name,".")})},[d,V,q,a,U]),$=(0,o.useCallback)(async()=>{if(!await U())return;if(!d||(null==V?void 0:V.channelType)!=="thermal"){a({title:"Cannot Add Temperature Block",description:"Please select a thermal channel first.",variant:"destructive"});return}let e=crypto.randomUUID(),t={id:e,type:"cool",intensity:"low",duration:2,startTime:0,blockRenderType:"temperature"};c(e=>e.map(e=>{if(e.id===d){let a=[...e.temperatureBlocks,t];return{...e,temperatureBlocks:W(a)}}return e})),p(e),a({title:"Temperature Block Added",description:"Block added to ".concat(null==V?void 0:V.name,".")})},[d,V,W,a,U]),ee=(0,o.useCallback)((e,t)=>{m(e),p(t)},[]),et=(0,o.useCallback)(e=>{d&&h&&c(t=>t.map(t=>{if(t.id===d){if("audio"===t.channelType&&("audio"===e.blockRenderType||"waveform"in e)){let a=t.audioBlocks.map(t=>{if(t.id===e.id){let a=Number(e.duration);if((isNaN(a)||a<0)&&(e.duration=t.duration),!e.isSilent&&!t.isSilent){let a={...e};if(a.duration!==t.duration&&t.duration>0&&a.duration>0){let e=a.duration/t.duration;a.attack===t.attack&&(a.attack=t.attack*e),a.decay===t.decay&&(a.decay=t.decay*e),a.release===t.release&&(a.release=t.release*e)}return eZ(a)}return e}return t});return{...t,audioBlocks:q(a)}}if("thermal"===t.channelType&&("temperature"===e.blockRenderType||"type"in e)){let a=t.temperatureBlocks.map(t=>t.id===e.id?e:t);return{...t,temperatureBlocks:W(a)}}}return t}))},[d,h,q,W]),ea=(0,o.useCallback)(e=>{d&&V&&(c(t=>t.map(t=>{if(t.id===d){if("audio"===t.channelType){let a=t.audioBlocks.filter(t=>t.id!==e);return{...t,audioBlocks:q(a)}}if("thermal"===t.channelType){let a=t.temperatureBlocks.filter(t=>t.id!==e);return{...t,temperatureBlocks:W(a)}}}return t})),h===e&&p(null),a({title:"Block Deleted",description:"Block removed from ".concat(null==V?void 0:V.name,"."),variant:"destructive"}))},[d,h,V,q,W,a]),en=(0,o.useCallback)((e,t,a)=>{c(n=>{let o=n.findIndex(t=>t.id===e);if(-1===o)return console.warn("[MusicSyncPage] handleReorderBlock: Channel ".concat(e," not found.")),n;let r={...n[o]};if("audio"===r.channelType){let e=[...r.audioBlocks],o=e.findIndex(e=>e.id===t);if(-1===o)return n;let[s]=e.splice(o,1);e.splice(a,0,s),r.audioBlocks=q(e)}else if("thermal"===r.channelType){let e=[...r.temperatureBlocks],o=e.findIndex(e=>e.id===t);if(-1===o)return n;let[s]=e.splice(o,1);e.splice(a,0,s),r.temperatureBlocks=W(e)}let s=[...n];return s[o]=r,s})},[q,W]),eo=(0,o.useCallback)(()=>{j(e=>!e)},[]);(0,o.useEffect)(()=>{O.current.looping||a({title:N?"Loop Enabled":"Loop Disabled",description:N?"Playback will now loop.":"Playback will not loop."}),O.current.looping&&(O.current.looping=!1)},[N,a]),(0,o.useEffect)(()=>{O.current.outputMode?O.current.outputMode=!1:a&&a({title:"Output Mode Changed",description:"Switched to ".concat("mixed"===k?"Mixed":"Independent"," Output.")})},[k,a]);let er=(0,o.useCallback)(()=>{A(e=>"mixed"===e?"independent":"mixed")},[]),es=(0,o.useRef)(f);(0,o.useEffect)(()=>{es.current=f},[f]);let el=(0,o.useRef)(N);(0,o.useEffect)(()=>{el.current=N},[N]);let ec=(0,o.useCallback)(()=>{console.log("[MusicSyncPage] handleStop: Called."),E.current&&(clearTimeout(E.current),E.current=null,console.log("[MusicSyncPage] handleStop: Cleared loop timeout."));let e=new Set;B.current.forEach((t,a)=>{t.forEach(t=>{t.adsrGain.gain.cancelScheduledValues(r.tB()),t.osc.stop(r.tB()),t.osc.dispose(),t.adsrGain.dispose(),t.channelVolumeNode&&e.add(t.channelVolumeNode)}),console.log("[MusicSyncPage] handleStop: Disposed osc/gain nodes for channel ID ".concat(a))}),e.forEach(e=>{e&&!e.disposed&&(console.log("[MusicSyncPage] handleStop: Disposing unique ChannelVolumeNode:",e),e.dispose())}),B.current.clear(),x(!1),b(0),I.current=null,D.current&&(cancelAnimationFrame(D.current),D.current=null),console.log("[MusicSyncPage] handleStop: Playback stopped and state reset.")},[]),ed=(0,o.useCallback)(async()=>{if(ec(),console.log("[MusicSyncPage] handlePlay: Called. Using ABSOLUTE TIME scheduling."),!await U()){console.log("[MusicSyncPage] handlePlay: ensureAudioIsActive returned false. Aborting.");return}if(!F.current||F.current.disposed){console.error("[MusicSyncPage] handlePlay: CRITICAL: MasterVolumeNode is not ready or disposed. Cannot play audio."),a({title:"Audio Error",description:"Master volume node not ready. Please try again or refresh.",variant:"destructive"});return}console.log("[MusicSyncPage] handlePlay: MasterVolumeNode is ready. Details:",F.current),x(!0);let e=r.tB()+.1;console.log("[MusicSyncPage] handlePlay: Base absolute time for scheduling: ".concat(e)),console.log("[MusicSyncPage] handlePlay: Number of channels: ".concat(i.length,". Channels data:"),JSON.parse(JSON.stringify(i)));let t=0;if(i.forEach(a=>{if("thermal"===a.channelType){let e=0;a.temperatureBlocks.forEach(t=>{let a=Number(t.duration);isNaN(a)||a<=0||(e+=a)}),e>t&&(t=e),console.log("[MusicSyncPage] handlePlay: Skipping audio synthesis for THERMAL channel ".concat(a.name,". Total duration: ").concat(e,"s"));return}if(a.isMuted||0===a.audioBlocks.length){console.log("[MusicSyncPage] handlePlay: Skipping channel ".concat(a.name," (ID: ").concat(a.id,") - not audio, muted, or no audio blocks."));return}console.log("[MusicSyncPage] handlePlay: Processing audio channel ".concat(a.name," (ID: ").concat(a.id,"). Blocks: ").concat(a.audioBlocks.length));let n=[],o=a.volume>.001&&!a.isMuted?r.F4(a.volume):-1/0,s=new r.fS(o);if(console.log("[MusicSyncPage] handlePlay: Channel ".concat(a.name," (ID: ").concat(a.id,") VolumeNode created, volume: ").concat(o,"dB.")),!F.current||F.current.disposed){console.error("[MusicSyncPage] handlePlay: CRITICAL ERROR for channel ".concat(a.name," - masterVolumeNodeRef.current is null or disposed before connecting ChannelVolumeNode."));return}console.log("[MusicSyncPage] handlePlay: Connecting ChannelVolumeNode for ".concat(a.name," to MasterVolumeNode.")),s.connect(F.current),console.log("[MusicSyncPage] MasterVolumeNode (after channel ".concat(a.name," connect) outputs: ").concat(F.current.numberOfOutputs,", inputs: ").concat(F.current.numberOfInputs,"."));let l=e,i=0;a.audioBlocks.forEach((e,t)=>{let o=Number(e.duration);if(isNaN(o)||o<=0){console.warn("[MusicSyncPage] handlePlay: Channel ".concat(a.name,", Block ").concat(t," (ID: ").concat(e.id,") has invalid or zero duration (").concat(e.duration,"). Skipping."));return}if(e.isSilent){console.log("[MusicSyncPage] handlePlay: Channel ".concat(a.name,", Block ").concat(t," (ID: ").concat(e.id,") is SILENT. Duration: ").concat(o,"s. Advancing time.")),l+=o,i+=o;return}let c=eZ(e);if(console.log("[MusicSyncPage] handlePlay: Channel ".concat(a.name,", Block ").concat(t," (ID: ").concat(c.id,") PROCESSING. Freq=").concat(c.frequency,"Hz, Dur=").concat(c.duration,"s. Scheduled to start at absolute time: ").concat(l.toFixed(3))),c.frequency<40&&c.frequency>0)console.warn("[MusicSyncPage] handlePlay: Audible block ".concat(c.id," in channel ").concat(a.name," has a very low frequency (").concat(c.frequency,"Hz). This may be inaudible or primarily felt as vibration."));else if(c.frequency<=0){console.warn("[MusicSyncPage] handlePlay: Audible block ".concat(c.id," in channel ").concat(a.name," has zero or negative frequency (").concat(c.frequency,"Hz). Skipping block.")),l+=o,i+=o;return}let d=new r.vq({type:c.waveform,frequency:c.frequency,volume:-6}),u=new r.OZ(0).connect(s);d.connect(u);let{duration:m,attack:h,decay:p,sustainLevel:f,release:x}=c,g=l,y=g+h,v=y+p,b=g+m-x,N=g+m;console.log("[MusicSyncPage] ADSR for block ".concat(c.id,": StartAbs=").concat(g.toFixed(3),", AttackEndsAbs=").concat(y.toFixed(3),", DecayEndsAbs=").concat(v.toFixed(3),", SustainLevel=").concat(f.toFixed(2),", ReleaseStartsAbs=").concat(b.toFixed(3),", BlockEndsAbs=").concat(N.toFixed(3))),u.gain.setValueAtTime(0,g),h>0?u.gain.linearRampToValueAtTime(1,y):u.gain.setValueAtTime(1,g),p>0?u.gain.linearRampToValueAtTime(f,v):u.gain.setValueAtTime(f,y),b>v&&u.gain.setValueAtTime(f,b),x>0?u.gain.linearRampToValueAtTime(0,N):u.gain.setValueAtTime(0,N),console.log("[MusicSyncPage] Oscillator for block ".concat(c.id," scheduled: osc.start(").concat(g.toFixed(3),"), osc.stop(").concat(N.toFixed(3),")")),d.start(g),d.stop(N),n.push({osc:d,adsrGain:u,channelVolumeNode:s}),l+=m,i+=m}),i>t&&(t=i),isNaN(t)&&(console.error("[MusicSyncPage] handlePlay: maxOverallDuration became NaN after processing channel ".concat(a.name,". Resetting to 0.")),t=0),n.length>0?(B.current.set(a.id,n),console.log("[MusicSyncPage] handlePlay: Stored ".concat(n.length," active audio nodes for channel ").concat(a.name,"."))):s&&!s.disposed&&(console.log("[MusicSyncPage] handlePlay: No audible blocks for channel ".concat(a.name,", disposing its volume node.")),s.dispose())}),t>0){I.current=r.tB(),console.log("[MusicSyncPage] handlePlay: Playback initiated. Max sequence duration: ".concat(t.toFixed(3),"s. isLooping: ").concat(el.current)),console.log("[MusicSyncPage] Current Tone.now() before setTimeout: ".concat(r.tB()));let e=(t+.1+.2)*1e3;console.log("[MusicSyncPage] handlePlay: Scheduling end/loop timeout for ".concat(e.toFixed(0),"ms from now. Loop status: ").concat(el.current)),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{let e=r.tB();if(console.log("[MusicSyncPage] Loop/Stop Timeout Fired. Current Tone.now(): ".concat(e,". playbackStartTimeRef was: ").concat(I.current)),null!==I.current){let a=e-(I.current-.1);console.log("[MusicSyncPage] Elapsed time since play started (according to Tone.now): ".concat(a.toFixed(3),"s. Expected maxOverallDuration: ").concat(t.toFixed(3),"s"))}es.current?el.current?(console.log("[MusicSyncPage] Loop: Triggering handlePlay again."),ed()):(console.log("[MusicSyncPage] handlePlay: Automatic stop after max duration."),ec()):console.log("[MusicSyncPage] handlePlay timeout: Playback was already stopped manually or by other means.")},e)}else console.log("[MusicSyncPage] handlePlay: Max overall duration is 0 or NaN, nothing to play. Resetting isPlaying."),x(!1)},[i,U,ec,a,q]);return(0,o.useEffect)(()=>{if(f&&null!==I.current){let e=()=>{if(null===I.current||!es.current){D.current&&cancelAnimationFrame(D.current),D.current=null;return}b(r.tB()-I.current),D.current=requestAnimationFrame(e)};D.current=requestAnimationFrame(e)}else D.current&&(cancelAnimationFrame(D.current),D.current=null);return()=>{D.current&&(cancelAnimationFrame(D.current),D.current=null)}},[f,v]),(0,o.useEffect)(()=>()=>{console.log("[MusicSyncPage] Unmounting. Stopping audio and disposing master volume node if it exists."),E.current&&clearTimeout(E.current),ec(),F.current&&!F.current.disposed&&(F.current.dispose(),F.current=null,console.log("[MusicSyncPage] Unmounting: Disposed masterVolumeNodeRef."))},[ec]),i.map(e=>"audio"===e.channelType?e.audioBlocks.reduce((e,t)=>e+60*(Number(t.duration)||0),0)+60:"thermal"===e.channelType?e.temperatureBlocks.reduce((e,t)=>e+60*(Number(t.duration)||0),0)+60:0),(0,n.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-to-br from-[hsl(var(--background)/0.5)] via-[hsl(var(--muted)/0.5)] to-[hsl(var(--background)/0.5)] p-0 sm:p-4 md:p-8",children:[(0,n.jsxs)(M,{className:"flex-grow flex flex-col shadow-2xl overflow-hidden bg-card rounded-none sm:rounded-xl h-full",children:[(0,n.jsx)("header",{className:"p-4 sm:p-6 border-b flex items-center justify-between sticky top-0 bg-card/80 backdrop-blur-sm z-10",children:(0,n.jsx)("div",{children:(0,n.jsxs)("h1",{className:"text-3xl sm:text-4xl font-bold text-gradient-primary-accent-secondary flex items-center",children:[(0,n.jsx)(ew.A,{className:"mr-3 h-8 w-8"}),"TouchCanvas"]})})}),(0,n.jsxs)("div",{className:"p-4 sm:p-6 flex-grow flex flex-col space-y-4 sm:space-y-6 overflow-hidden",children:[(0,n.jsx)(R,{isPlaying:f,isLooping:N,isActivatingAudio:g,outputMode:k,masterVolume:S,onPlay:ed,onStop:ec,onAddBlock:Y,onAddSilenceBlock:Q,onAddTemperatureBlock:$,onToggleLoop:eo,onToggleOutputMode:er,onMasterVolumeChange:_,onTestAudio:z,canPlay:i.some(e=>"audio"===e.channelType&&!e.isMuted&&e.audioBlocks.some(e=>{let t=Number(e.duration);return!e.isSilent&&!isNaN(t)&&t>0&&(!!e.isSilent||e.frequency>0)})),disableAddAudioBlock:!d||(null==V?void 0:V.channelType)!=="audio",disableAddTemperatureBlock:!d||(null==V?void 0:V.channelType)!=="thermal"}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row flex-grow space-y-4 md:space-y-0 md:space-x-6 overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex-grow md:w-2/3 flex flex-col space-y-2 overflow-y-auto pr-9 pl-5 pt-5 pb-5 relative",children:[i.map(e=>(0,n.jsx)(eR,{channel:e,isSelected:e.id===d,selectedBlockId:h,onSelectChannel:K,onUpdateChannel:X,onSelectBlock:ee,onReorderBlock:en,onDeleteChannelRequest:Z,pixelsPerSecond:60,currentPlayTime:v,isPlaying:f},e.id)),(0,n.jsxs)("div",{className:"flex space-x-2 mt-4",children:[(0,n.jsxs)(u,{onClick:H,variant:"outline",className:"flex-1",children:[(0,n.jsx)(ew.A,{className:"mr-2 h-5 w-5"})," Add Audio Channel"]}),(0,n.jsxs)(u,{onClick:J,variant:"outline",className:"flex-1",disabled:G,children:[(0,n.jsx)(w.A,{className:"mr-2 h-5 w-5"})," Add Thermal Channel"]})]})]}),(0,n.jsx)(ei,{className:"w-full md:w-1/3 md:min-w-[320px] md:max-w-sm",selectedBlock:L,selectedChannelType:(null==V?void 0:V.channelType)||null,onUpdateBlock:et,onDeleteBlock:ea,pixelsPerSecond:60},null==L?void 0:L.id)]})]})]}),(0,n.jsx)(eO,{open:!!T,onOpenChange:e=>!e&&P(null),children:(0,n.jsxs)(eU,{children:[(0,n.jsxs)(ez,{children:[(0,n.jsx)(eq,{children:"Are you sure you want to delete this channel?"}),(0,n.jsxs)(eW,{children:['Channel: "',(null==T?void 0:T.name)||"Selected Channel",'"',(0,n.jsx)("br",{}),"All blocks in this channel will be permanently lost. This action cannot be undone."]})]}),(0,n.jsxs)(e_,{children:[(0,n.jsx)(eG,{onClick:()=>P(null),children:"Cancel"}),(0,n.jsx)(eH,{onClick:()=>{if(!T)return;let e=T.id;c(t=>{let a=t.filter(t=>t.id!==e);return d===e&&(p(null),a.length>0?m(a[0].id):m(null)),a}),a({title:"Channel Deleted",description:'Channel "'.concat(T.name,'" has been removed.')}),P(null)},children:"Delete Channel"})]})]})})]})}},7079:(e,t,a)=>{Promise.resolve().then(a.bind(a,1063))},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>m});var n=a(2115);let o=0,r=new Map,s=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?s(a):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=l(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,a=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||n()}}}),{id:a,dismiss:n,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=n.useState(c);return n.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},8301:(e,t,a)=>{"use strict";a.d(t,{L:()=>i,ToneProvider:()=>c});var n=a(5155),o=a(2115),r=a(588),s=a(7481);let l=(0,o.createContext)(null),i=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useToneContext must be used within a ToneProvider");return e},c=e=>{let{children:t}=e,[a,i]=(0,o.useState)(!1),{toast:c}=(0,s.dj)(),d=(0,o.useCallback)(async()=>{if(console.log("[ToneProvider] Attempting to start audio context. Current state:",r._O.state),"running"!==r._O.state)try{await r.ni(),i(!0),console.log("[ToneProvider] Tone.start() successful. Audio context state:",r._O.state),console.log("[ToneProvider] Tone.Destination.volume.value (dB):",r.DW.volume.value),c({title:"Audio Initialized",description:"Sound is now enabled."})}catch(e){console.error("[ToneProvider] Failed to start Tone.js audio context:",e),c({title:"Audio Error",description:"Could not initialize audio. Please try interacting with the page again.",variant:"destructive"})}else i(!0),console.log("[ToneProvider] Audio context was already running. State:",r._O.state),r.DW?console.log("[ToneProvider] Tone.Destination.volume.value (dB):",r.DW.volume.value):console.warn("[ToneProvider] Tone.Destination is not available yet to check volume.")},[c]);return(0,n.jsx)(l.Provider,{value:{audioContextStarted:a,startAudioContext:d},children:t})}},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var n=a(2596),o=a(9688);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.QP)((0,n.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[307,8,441,684,358],()=>t(7079)),_N_E=e.O()}]);